{% extends 'partials/base.html' %}
{% load static %}

{% block title %}Forms{% endblock title %}

{% block extra_css %}

<!-- datepicker css -->
<link rel="stylesheet" href="{% static 'libs/flatpickr/dist/flatpickr.min.css'%}">
{% endblock extra_css %}

{% block content %}
    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="main-content">
        <div class="page-content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                            <h4 class="mb-sm-0 font-size-18">Sample Form</h4>
                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">Sample Form</a></li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Form Name</h4>
                                <p class="card-title-desc">You can add more description here</p>
                            </div>
                            <div class="card-body">
                                <form class="needs-validation" id="form_1" name="form_1" novalidate method="POST" action="{% url 'backend:my_form_submit' %}">
                                    {% csrf_token %}

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label" for="fname">First name</label>
                                                <input type="text" class="form-control" id="fname" name="fname"
                                                       placeholder="First name" maxlength="50" required
                                                       value="{{ form_data.fname.value|default:'' }}" pattern="[a-zA-Z\s]+">
                                                <div class="valid-feedback"></div>
                                                <div class="invalid-feedback">
                                                    Please enter a valid first name
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label" for="lname">Last name</label>
                                                <input type="text" class="form-control" id="lname" name="lname" placeholder="Last name" value="" required pattern="[a-zA-Z\s]+" maxlength="50">
                                                <div class="valid-feedback"></div>
                                                <div class="invalid-feedback">
                                                    Please enter a valid last name
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label" for="email">Email</label>
                                                <input type="email" class="form-control" id="email" name="email" placeholder="Email" value="pranav.g33k@gmail.com" required maxlength="50">
                                                <div class="valid-feedback"></div>
                                                <div class="invalid-feedback">
                                                    Please enter a valid email address
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label" for="password">Password</label>
                                                <input type="password" class="form-control" id="password" name="password" value="" required maxlength="50">
                                                <div class="valid-feedback"></div>
                                                <div class="invalid-feedback">
                                                    Please enter a password
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="mb-3">
{#                                                <label class="form-label">Gender</label>#}
                                                <div class="form-check form-check-inline mb-3">
                                                    <input class="form-check-input" type="radio" name="gender" id="male" required value="male" checked>
                                                    <label class="form-check-label" for="male">Male</label>
                                                </div>
                                                <div class="form-check form-check-inline mb-3">
                                                    <input class="form-check-input" type="radio" name="gender" id="female" required value="f">
                                                    <label class="form-check-label" for="female">Female</label>
                                                </div>
                                                <div class="form-check form-check-inline mb-3">
                                                    <input class="form-check-input" type="radio" name="gender" id="other" required value="u">
                                                    <label class="form-check-label" for="other+--">Unspecified</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label" for="dob">Date of birth</label>
                                                <input type="text" class="form-control" id="dob" name="dob" value="" required>
                                                <div class="valid-feedback">
                                                    Looks good!
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label" for="age">Age</label>
                                                <input type="text" class="form-control" id="age" name="age" value="" readonly>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="mb-3">
                                                <label class="form-label" for="image">Profile image</label>
                                                <input class="form-control" type="file" id="image" name="image" accept=".jpg,.jpeg,.png" onchange="preview()">
                                                <div class="valid-feedback"></div>
                                                <div class="invalid-feedback">
                                                    Please choose a valid image file
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <div id="file_info"></div>
                                                <img id="img_preview" src="" class="img-fluid" style="width: 200px" />
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group mb-3 form-check">
                                                <input id="tnc" type="checkbox" class="form-check-input" name="tnc" required checked />
                                                <label class="form-check-label" for="term-check01">I accept the terms and conditions</label>
                                                <div class="invalid-feedback">
                                                    Please accept terms and conditions
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <button class="btn btn-primary" type="submit">Submit</button>
                                    <button class="btn btn-secondary" type="reset" id="reset">Reset</button>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block extra_js %}
<!-- datepicker js -->
<script src="{% static 'libs/flatpickr/dist/flatpickr.min.js'%}"></script>
<script>
    flatpickr("#dob", {
        defaultDate: "today",
        maxDate: "today",
        minDate: "1940-01-01"
    });
    $("#dob").change(function() {
        var dob = new Date($("#dob").val());
        var today = new Date();
        $("#age").val(Math.floor((today - dob) / (365.25 * 24 * 60 * 60 * 1000)))
    });
</script>

<!-- form validation -->
<script>
! function() {
    "use strict";
    window.addEventListener("load", function() {
        var e = document.getElementsByClassName("needs-validation");
        Array.prototype.filter.call(e, function(t) {
            t.addEventListener("submit", function(e) {
                !1 === t.checkValidity() && (e.preventDefault(), e.stopPropagation()), t.classList.add("was-validated")
            }, !1)
        })
    }, !1)
}();

function preview() {
    var file = event.target.files[0];

    img_preview.src = URL.createObjectURL(file);

    // Get file info
    var size = (file.size / 1024).toFixed(2) + " KB";
    var type = file.type;
    var dimensions = "Unknown";

    // Validate file type
    if (!type.startsWith("image/")) {
        document.querySelector('#image').value = "";
        img_preview.src = "";
        return;
    }

    // Extract dimensions if available
    if (type.startsWith("image/")) {
        var reader = new FileReader();
        reader.onload = function() {
            var image = new Image();
            image.onload = function() {
                dimensions = this.width + " x " + this.height + " pixels";
                document.querySelector('#file_info').innerHTML = "File info: " + size + ", " + type + ", " + dimensions;
                {#$("#file_info").innerHTML = "File info: " + size + ", " + type + ", " + dimensions#}
            };
            image.src = reader.result;
        };
        reader.readAsDataURL(file);
    } else {
        document.querySelector('#file_info').innerHTML = "File info: " + size + ", " + type + ", " + dimensions;
        {#$("#file_info").innerHTML = "File info: " + size + ", " + type + ", " + dimensions;#}
    }
}

$("#reset").click(function(){
    img_preview.src = "";
});
</script>
{% endblock extra_js %}